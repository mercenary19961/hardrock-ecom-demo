<?php

namespace Database\Seeders;

use App\Models\Category;
use App\Models\Product;
use App\Models\ProductImage;
use Illuminate\Database\Seeder;
use Illuminate\Support\Str;

class ProductSeeder extends Seeder
{
    public function run(): void
    {
        $products = [
            // Electronics - Smartphones (7 products)
            [
                'category' => 'smartphones',
                'name' => 'iPhone 15 Pro Max 256GB',
                'short' => 'Apple\'s flagship with A17 Pro chip, titanium design, and 48MP camera system.',
                'price' => 1399.00,
                'compare' => null,
                'stock' => 25,
                'featured' => true,
                'times_purchased' => 156,
                'average_rating' => 4.8,
                'rating_count' => 89,
                'view_count' => 2340,
            ],
            [
                'category' => 'smartphones',
                'name' => 'Samsung Galaxy S24 Ultra',
                'short' => 'AI-powered Galaxy with S Pen, 200MP camera, and Snapdragon 8 Gen 3.',
                'price' => 1299.00,
                'compare' => 1449.00,
                'stock' => 18,
                'featured' => true,
                'times_purchased' => 203,
                'average_rating' => 4.7,
                'rating_count' => 124,
                'view_count' => 3150,
            ],
            [
                'category' => 'smartphones',
                'name' => 'Xiaomi 14 Pro',
                'short' => 'Leica optics, Snapdragon 8 Gen 3, and 120W HyperCharge.',
                'price' => 799.00,
                'compare' => 899.00,
                'stock' => 35,
                'featured' => false,
                'times_purchased' => 87,
                'average_rating' => 3.5,
                'rating_count' => 56,
                'view_count' => 1890,
            ],
            [
                'category' => 'smartphones',
                'name' => 'HUAWEI Mate 60 Pro',
                'short' => 'Satellite calling, Kirin 9000S chip, and variable aperture camera.',
                'price' => 999.00,
                'compare' => null,
                'stock' => 12,
                'featured' => false,
                'times_purchased' => 34,
                'average_rating' => 3.0,
                'rating_count' => 23,
                'view_count' => 980,
            ],
            [
                'category' => 'smartphones',
                'name' => 'OPPO Reno 11 Pro',
                'short' => 'Portrait expert with Hasselblad color science and 80W fast charging.',
                'price' => 549.00,
                'compare' => 649.00,
                'stock' => 42,
                'featured' => false,
                'times_purchased' => 112,
                'average_rating' => 4.5,
                'rating_count' => 67,
                'view_count' => 1560,
            ],
            [
                'category' => 'smartphones',
                'name' => 'Google Pixel 8 Pro',
                'short' => 'Best-in-class AI photography with Tensor G3 chip and 7 years of updates.',
                'price' => 999.00,
                'compare' => 1099.00,
                'stock' => 20,
                'featured' => true,
                'times_purchased' => 145,
                'average_rating' => 4.6,
                'rating_count' => 98,
                'view_count' => 2780,
            ],
            [
                'category' => 'smartphones',
                'name' => 'OnePlus 12',
                'short' => 'Flagship killer with Snapdragon 8 Gen 3 and 100W SUPERVOOC charging.',
                'price' => 799.00,
                'compare' => null,
                'stock' => 28,
                'featured' => false,
                'times_purchased' => 78,
                'average_rating' => 4.5,
                'rating_count' => 45,
                'view_count' => 1340,
            ],

            // Electronics - Laptops (7 products)
            [
                'category' => 'laptops',
                'name' => 'MacBook Pro 14" M3 Pro',
                'short' => 'Apple silicon powerhouse with Liquid Retina XDR display and 18-hour battery.',
                'price' => 1999.00,
                'compare' => null,
                'stock' => 8,
                'featured' => true,
                'low_threshold' => 5,
                'times_purchased' => 89,
                'average_rating' => 4.9,
                'rating_count' => 67,
                'view_count' => 2890,
            ],
            [
                'category' => 'laptops',
                'name' => 'Dell XPS 15 (2024)',
                'short' => 'Intel Core Ultra, OLED display, and premium aluminum build.',
                'price' => 1599.00,
                'compare' => 1799.00,
                'stock' => 15,
                'featured' => true,
                'times_purchased' => 67,
                'average_rating' => 4.6,
                'rating_count' => 43,
                'view_count' => 1980,
            ],
            [
                'category' => 'laptops',
                'name' => 'ASUS ROG Strix G16',
                'short' => 'RTX 4070 gaming laptop with 165Hz display and RGB lighting.',
                'price' => 1449.00,
                'compare' => null,
                'stock' => 10,
                'featured' => false,
                'times_purchased' => 45,
                'average_rating' => 4.7,
                'rating_count' => 34,
                'view_count' => 2340,
            ],
            [
                'category' => 'laptops',
                'name' => 'Lenovo ThinkPad X1 Carbon Gen 11',
                'short' => 'Business ultrabook with Intel vPro, 4G LTE, and legendary keyboard.',
                'price' => 1699.00,
                'compare' => 1899.00,
                'stock' => 6,
                'featured' => false,
                'low_threshold' => 5,
                'times_purchased' => 38,
                'average_rating' => 4.8,
                'rating_count' => 29,
                'view_count' => 1120,
            ],
            [
                'category' => 'laptops',
                'name' => 'HP Pavilion 15',
                'short' => 'Affordable everyday laptop with Intel Core i5 and 512GB SSD.',
                'price' => 549.00,
                'compare' => 649.00,
                'stock' => 45,
                'featured' => false,
                'times_purchased' => 234,
                'average_rating' => 3.5,
                'rating_count' => 156,
                'view_count' => 4560,
            ],
            [
                'category' => 'laptops',
                'name' => 'Microsoft Surface Laptop 5',
                'short' => 'Sleek design with PixelSense touchscreen and all-day battery life.',
                'price' => 1299.00,
                'compare' => null,
                'stock' => 12,
                'featured' => false,
                'times_purchased' => 52,
                'average_rating' => 4.4,
                'rating_count' => 38,
                'view_count' => 1670,
            ],
            [
                'category' => 'laptops',
                'name' => 'Acer Swift Go 14',
                'short' => 'Ultra-portable with Intel Core Ultra and stunning 2.8K OLED display.',
                'price' => 899.00,
                'compare' => 999.00,
                'stock' => 22,
                'featured' => false,
                'times_purchased' => 76,
                'average_rating' => 4.3,
                'rating_count' => 51,
                'view_count' => 1890,
            ],

            // Electronics - Accessories (6 products)
            [
                'category' => 'accessories',
                'name' => 'Apple AirPods Pro 2nd Gen',
                'short' => 'Active noise cancellation, spatial audio, and USB-C charging case.',
                'price' => 249.00,
                'compare' => null,
                'stock' => 65,
                'featured' => true,
                'times_purchased' => 312,
                'average_rating' => 4.8,
                'rating_count' => 234,
                'view_count' => 5670,
            ],
            [
                'category' => 'accessories',
                'name' => 'Samsung 25W USB-C Charger',
                'short' => 'Super fast charging adapter compatible with Galaxy devices.',
                'price' => 29.00,
                'compare' => 39.00,
                'stock' => 150,
                'featured' => false,
                'times_purchased' => 567,
                'average_rating' => 4.5,
                'rating_count' => 312,
                'view_count' => 3450,
            ],
            [
                'category' => 'accessories',
                'name' => 'Anker PowerCore 20000mAh',
                'short' => 'High-capacity power bank with dual USB ports and fast charging.',
                'price' => 59.00,
                'compare' => null,
                'stock' => 85,
                'featured' => false,
                'times_purchased' => 289,
                'average_rating' => 4.6,
                'rating_count' => 198,
                'view_count' => 2890,
            ],
            [
                'category' => 'accessories',
                'name' => 'Logitech MX Master 3S',
                'short' => 'Quiet clicks, 8K DPI sensor, and MagSpeed electromagnetic scrolling.',
                'price' => 99.00,
                'compare' => 119.00,
                'stock' => 40,
                'featured' => true,
                'times_purchased' => 178,
                'average_rating' => 4.9,
                'rating_count' => 145,
                'view_count' => 3120,
            ],
            [
                'category' => 'accessories',
                'name' => 'JBL Tune 760NC Headphones',
                'short' => 'Wireless over-ear headphones with active noise cancelling and 50hr battery.',
                'price' => 119.00,
                'compare' => 149.00,
                'stock' => 55,
                'featured' => false,
                'times_purchased' => 156,
                'average_rating' => 4.4,
                'rating_count' => 112,
                'view_count' => 2340,
            ],
            [
                'category' => 'accessories',
                'name' => 'Apple Watch Series 9',
                'short' => 'Advanced health features with double tap gesture and brighter display.',
                'price' => 429.00,
                'compare' => null,
                'stock' => 30,
                'featured' => true,
                'times_purchased' => 134,
                'average_rating' => 4.7,
                'rating_count' => 89,
                'view_count' => 3890,
            ],

            // Skincare (5 products)
            [
                'category' => 'skincare',
                'name' => 'La Roche-Posay Effaclar Duo',
                'short' => 'Dual action acne treatment for oily and blemish-prone skin.',
                'price' => 28.00,
                'compare' => null,
                'stock' => 75,
                'featured' => false,
                'times_purchased' => 198,
                'average_rating' => 4.5,
                'rating_count' => 134,
                'view_count' => 2780,
            ],
            [
                'category' => 'skincare',
                'name' => 'CeraVe Moisturizing Cream',
                'short' => 'Rich cream with ceramides and hyaluronic acid for 24hr hydration.',
                'price' => 19.00,
                'compare' => 25.00,
                'stock' => 110,
                'featured' => true,
                'times_purchased' => 456,
                'average_rating' => 4.8,
                'rating_count' => 298,
                'view_count' => 6780,
            ],
            [
                'category' => 'skincare',
                'name' => 'The Ordinary Niacinamide 10%',
                'short' => 'Serum for reducing blemishes and balancing sebum.',
                'price' => 12.00,
                'compare' => null,
                'stock' => 95,
                'featured' => false,
                'times_purchased' => 534,
                'average_rating' => 4.6,
                'rating_count' => 367,
                'view_count' => 5430,
            ],
            [
                'category' => 'skincare',
                'name' => 'Dead Sea Mud Mask',
                'short' => 'Authentic Jordan Dead Sea mud for deep pore cleansing.',
                'price' => 24.00,
                'compare' => 32.00,
                'stock' => 60,
                'featured' => true,
                'times_purchased' => 267,
                'average_rating' => 4.7,
                'rating_count' => 189,
                'view_count' => 3450,
            ],
            [
                'category' => 'skincare',
                'name' => 'Bioderma Sensibio H2O Micellar',
                'short' => 'Gentle makeup remover for sensitive skin, 500ml.',
                'price' => 22.00,
                'compare' => null,
                'stock' => 85,
                'featured' => false,
                'times_purchased' => 312,
                'average_rating' => 4.6,
                'rating_count' => 234,
                'view_count' => 2980,
            ],
        ];

        foreach ($products as $productData) {
            $category = Category::where('slug', $productData['category'])->first();

            if (!$category) {
                continue;
            }

            $product = Product::create([
                'category_id' => $category->id,
                'name' => $productData['name'],
                'slug' => Str::slug($productData['name']),
                'description' => $this->generateDescription($productData['name'], $productData['short']),
                'short_description' => $productData['short'],
                'price' => $productData['price'],
                'compare_price' => $productData['compare'],
                'sku' => $this->generateSku($category->slug),
                'stock' => $productData['stock'],
                'low_stock_threshold' => $productData['low_threshold'] ?? null,
                'is_active' => true,
                'is_featured' => $productData['featured'],
                'times_purchased' => $productData['times_purchased'] ?? 0,
                'average_rating' => $productData['average_rating'] ?? 0,
                'rating_count' => $productData['rating_count'] ?? 0,
                'view_count' => $productData['view_count'] ?? 0,
            ]);

            // Create product image using product slug
            ProductImage::create([
                'product_id' => $product->id,
                'path' => "products/{$product->slug}.webp",
                'alt_text' => $product->name,
                'sort_order' => 0,
                'is_primary' => true,
            ]);
        }
    }

    private function generateSku(string $categorySlug): string
    {
        $prefix = match ($categorySlug) {
            'smartphones' => 'PHN',
            'laptops' => 'LAP',
            'accessories' => 'ACC',
            'skincare' => 'SKN',
            default => 'PRD',
        };

        return $prefix . '-' . strtoupper(Str::random(2)) . rand(1000, 9999);
    }

    private function generateDescription(string $name, string $shortDesc): string
    {
        return "{$shortDesc}";
    }
}
